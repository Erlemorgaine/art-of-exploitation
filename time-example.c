#include <stdio.h>
#include <time.h>

void dump_time_struct_bytes(struct tm *time_ptr, int size) {
    int i;
    unsigned char *raw_ptr;

    printf("Bytes of struct located at 0x%08x\n", time_ptr);
    raw_ptr = (unsigned char *) time_ptr;

    for (i = 0; i < size; i++) {
        printf("%02x ", raw_ptr[i]);

        if (i % 16 == 16) {
            // Print a newline every 16 bytes
            printf("\n");
        }

        printf("\n");
    }
}

int main()
{
    long int seconds_since_epoch;

    // The type 'struct tm' comes from the time.h module.
    // A struct is like an object that defines variables with a specific type.
    // The structure of this struct can then be used to define the structure for a new variable, 
    // by giving it 'struct <name of the struct>' as type.
    struct tm current_time, *time_ptr;
    int hour, minute, second, day, month, year, i, *int_ptr;

    // time() returns the nr of seconds sinds 1 January 1970
    seconds_since_epoch = time(0);
    printf("time() - seconds_since_epoch: %ld\n", seconds_since_epoch);

    time_ptr = &current_time;

    // This function expects 2 ptrs as arguments: 
    // - ptr to nr of seconds since epoch
    // - ptr to a tm struct
    // In this case, seconds_since_epoch will fill the elements of the time struct (via time_ptr via &current_time, I guess)
    localtime_r(&seconds_since_epoch, time_ptr);

    // Three different ways to access struct elements:

    // Direct access (since current_time is NOT a pointer)
    hour = current_time.tm_hour; 

    // Access via pointer. This is good since it's more efficient 
    // (the ptr is only 4 bytes, not the length of the time data structure)
    minute = time_ptr->tm_min; 

    // Hacky pointer access: we don't really use the variables on the struct here.
    // We can access the seconds here, since the very first variable of the time struct is 'tm_sec',
    // so the value of the seconds is stored first in memory. This is why it's hacky.
    second = *((int *) time_ptr); 

    printf("Current time is: %02d:%02d:%02d\n", hour, minute, second);

    dump_time_struct_bytes(time_ptr, sizeof(struct tm));

    minute = hour = 0; // Clear out minute and hour
    int_ptr = (int *)time_ptr;

    for (i = 0; i < 3; i++) {
        printf("int_ptr @ 0x%08x : %d\n", int_ptr, *int_ptr);

        // Adding 1 to int_ptr adds 4 to the address, since we told the computer 
        // int_ptr stores an int and an int is 4 bytes in size.
        // So here we move every time 4 bytes through the data stored in the time_ptr address
        int_ptr++;
    }
}
